<tal:block metal:use-macro="view.site_style">
    <tal:block metal:fill-slot="javascript">
    
        <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="/static/js/excanvas.min.js"></script><![endif]-->
        <script language="javascript" type="text/javascript" src="/static/js/jquery.jqplot.min.js"></script>
        <script type="text/javascript" src="/static/js/plugins/jqplot.dateAxisRenderer.min.js"></script>
        <link rel="stylesheet" type="text/css" href="/static/js/jquery.jqplot.min.css" />
        <script language="javascript" type="text/javascript" src="/static/js/jquery.csv.min.js"></script>
        <script language="javascript" type="text/javascript" src="/static/js/teamrubber.series.js"></script>
        
        <!-- Refresh automatically every once in a while -->
        <meta http-equiv="refresh" content="600; URL=${request.resource_url(milestone)}" />
    
    </tal:block>
    
    <tal:block metal:fill-slot="content">
    
        <div class="container">
            <h2 tal:condition="python:(milestone != None)">Stats for ${milestone.title} on ${today.date.strftime("%d/%m/%Y")}</h2>
            <h2 tal:condition="python:(milestone == None)">Stats for ${date_str}</h2>
            <div class="remaining" tal:condition="not:period">
                <h3>Remaining:</h3>
                <table class="table table-bordered" style="font-size: 24px;">
                  <thead>
                    <tr style="background: #eaeaea;">
                        <th>Total Tickets</th>
                        <th>Unpointed tickets</th>
                        <th>Dev Points</th>
                        <th>QA Points</th>
                        <th>Total Points</th>
                    </tr>
                  </thead>
                  <tbody tal:define="totals today.totals">
                    <tr>
                        <td>${len(totals['tickets'])}</td>
                        <td>${len(totals['unp'])}</td>
                        <td>${totals['devp']}</td>
                        <td>${totals['qap']}</td>
                        <td>${totals['devp'] + totals['qap']}</td>
                    </tr>
                  </tbody>
                </table>
            </div>
            <br />

            <div class="completed small" tal:condition="not:period">
                <h3>Completed yesterday:</h3>
                <table class="table table-bordered" style="font-size: 24px;">
                  <thead>
                    <tr style="background: #eaeaea;">
                        <th>Total Tickets</th>
                        <th>Unpointed tickets</th>
                        <th>Dev Points</th>
                        <th>QA Points</th>
                        <th>Total Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                        <td>${len(diff['tickets'])}</td>
                        <td>${len(diff['unp'])}</td>
                        <td>${diff['devp']}</td>
                        <td>${diff['qap']}</td>
                        <td>${diff['devp'] + diff['qap']}</td>
                    </tr>
                  </tbody>
                </table>
            </div>

            <div id="points"></div>
            <br />
            <div id="tickets"></div>
            <p class="small text-right muted">Page generated: ${today.date.isoformat()}</p>
            
            <br />
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" tal:content="structure chart" height="300px" />
            
            <tal:block tal:condition="python:(yesterday is not None)">
                <a class="pull-left" href="${request.resource_url(yesterday)}">Previous Day</a>
            </tal:block>
            <tal:block tal:condition="python:(tomorrow is not None)">
                <a class="pull-right" href="${request.resource_url(tomorrow)}">Next Day</a>
            </tal:block>
            
            <br /><br />
        </div>
        
        
    </tal:block>
</tal:block>