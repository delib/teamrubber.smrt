<tal:block metal:use-macro="view.site_style">
    <tal:block metal:fill-slot="javascript">
    
        <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="/static/js/excanvas.min.js"></script><![endif]-->
        <script language="javascript" type="text/javascript" src="/static/js/jquery.jqplot.min.js"></script>
        <script type="text/javascript" src="/static/js/plugins/jqplot.dateAxisRenderer.min.js"></script>
        <link rel="stylesheet" type="text/css" href="/static/js/jquery.jqplot.min.css" />
        <script language="javascript" type="text/javascript" src="/static/js/jquery.csv.min.js"></script>
        <script language="javascript" type="text/javascript" src="/static/js/teamrubber.series.js"></script>
        <script tal:condition="python:(milestone != None)">
            $(function(){
                $.get("/publish/${milestone.__parent__.short_name}-${milestone.short_name}.csv", function(data) {
                    var lines = $.csv.toArrays(data);
                    var series = translateArraysToSeries(lines);
                    plotChart(series);
                }, "text").fail(
                    function(jqxhr, status, message)
                    {
                        console.log(jqxhr);
                        console.log(status);
                        console.log(message);
                    }
                );
            
            });
        </script>
        
        <!-- Refresh automatically every once in a while -->
        <meta http-equiv="refresh" content="600; URL=${request.resource_url(milestone)}" />
    
    </tal:block>
    
    <tal:block metal:fill-slot="content">
    
        <div class="container">
            <h2 tal:condition="python:(milestone != None)">Stats for ${milestone.name} on ${today.date.strftime("%d/%m/%Y")}</h2>
            <h2 tal:condition="python:(milestone == None)">Stats for ${today.date.strftime("%d/%m/%Y")}</h2>
            <div class="remaining">
                <h3>Remaining:</h3>
                <table class="table table-bordered" style="font-size: 24px;">
                  <thead>
                    <tr style="background: #eaeaea;">
                        <th>Total Tickets</th>
                        <th>Unpointed tickets</th>
                        <th>Dev Points</th>
                        <th>QA Points</th>
                        <th>Total Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                        <td>${today.rem_total_tickets}</td>
                        <td>${today.rem_unpointed_tickets}</td>
                        <td>${today.rem_dev_points}</td>
                        <td>${today.rem_qa_points}</td>
                        <td>${today.rem_dev_points + today.rem_qa_points}</td>
                    </tr>
                  </tbody>
                </table>
            </div>
            <br />
            <div class="completed small">
                <h3>Completed yesterday (or nearest weekday)</h3>
                <table class="table table-bordered" style="font-size: 24px;">
                  <thead>
                    <tr style="background: #eaeaea;">
                        <th>Total Tickets</th>
                        <th>Unpointed tickets</th>
                        <th>Dev Points</th>
                        <th>QA Points</th>
                        <th>Total Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                        <td>${today.yest_total_tickets}</td>
                        <td>${today.yest_unpointed_tickets}</td>
                        <td>${today.yest_dev_points}</td>
                        <td>${today.yest_qa_points}</td>
                        <td>${today.yest_dev_points + today.yest_qa_points}</td>
                    </tr>
                  </tbody>
                </table>
            </div>
            <div id="points"></div>
            <br />
            <div id="tickets"></div>
            <p class="small text-right muted">Page generated: ${today.date.isoformat()}</p>
            
            <br />
            
            <tal:block tal:condition="python:(yesterday != None)">
                <a class="pull-left" href="${request.resource_url(yesterday)}">Previous Day</a>
            </tal:block>
            <tal:block tal:condition="python:(tomorrow != None)">
                <a class="pull-right" href="${request.resource_url(tomorrow)}">Next Day</a>
            </tal:block>
            
            <br /><br />
        </div>
        
        
    </tal:block>
</tal:block>